import { checkParameter, isAudio } from '../errors.js'

/**
 * Adds audio to the video at the timestamp this function is called.
 * @param {string} audiofile - The path to the audiofile to be added.
 * @returns {number} - Time till the audio file finishes playing.
 */
function addAudio(audiofile) {
    if (Cypress.env('CY_VIDEO_MODE') != true) {
        return 0
    }

    if(Cypress.config('isInteractive')){
        cy.task("getAudioData", {soundFile: audiofile}, {log: false}).then((a) => {new Audio("data:audio/wav;base64, "+a).play()})
    }
    
    Cypress.log({displayMessage: "addAudio"})

    checkParameter(audiofile, isAudio, "audiofile", "addAudio")

    cy.task('addSound', {soundFile: audiofile, interactive: Cypress.config('isInteractive')}, {log: false})
    cy.wait(10, {log: false}) //wait a little
    return cy.task("getAudioLength", {soundFile: audiofile}, {log: false})
}

Cypress.Commands.add('addAudio', {prevSubject : false}, addAudio)