const { checkParameter, isNonNegative } = require("../errors")

/**
 * Child command.
 * Type text into the subject with a custom delay.
 * @param {Cypress.chainable} subject - The textbox to type into. Value supplied by Cypress.
 * @param {string} text - The text to type.
 * @param {float} [delay] - The delay between each character input. Defaults to 50ms.
 */
const slowType = (subject, text, {
    animationDistanceThreshold = 5,
    delay = 50,
    force = false,
    log = true,
    parseSpecialCharSequences = true,
    release = true,
    scrollBehavior = 'top',
    timeout = 4000,
    waitForAnimations = true

} = {}) => {
    Cypress.log({consoleProps: () => {
        return {
            Text: text,
            Delay: delay
        }
    }})

    checkParameter(delay, isNonNegative, 'delay', 'slowType')
    checkParameter(text, {message: "is a string", function: (t) => typeof t == 'string'}, 'delay', 'slowType')

    if (Cypress.env('CY_VIDEO_MODE') != true) {
        cy.wrap(subject, {log: false}).type(text)
        return
    }

    cy.wrap(subject, {log: false}).type(text, {animationDistanceThreshold: animationDistanceThreshold,
         delay: delay, force: force, log: log, parseSpecialCharSequences: parseSpecialCharSequences, release: release, scrollBehavior: scrollBehavior,
         timeout: timeout , waitForAnimations: waitForAnimations})
    
    return cy.wrap(subject, {log: false})
}

Cypress.Commands.add('slowType', {prevSubject : true}, slowType)
